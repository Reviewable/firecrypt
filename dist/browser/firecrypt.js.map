{"version":3,"file":"firecrypt.js","sources":["src/utils.js","src/firecrypt.js"],"sourcesContent":["let _spec;\nlet _encryptionCache;\nlet _decryptionCache;\n\nexport function setSpec(spec) {\n  _spec = cleanSpecification(spec);\n};\n\nexport function setEncryptionCache(cache) {\n  _encryptionCache = cache;\n};\n\nexport function setDecryptionCache(cache) {\n  _decryptionCache = cache;\n};\n\nexport function cleanSpecification(def, path) {\n  var keys = Object.keys(def);\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (key === '.encrypt') {\n      var encryptKeys = Object.keys(def[key]);\n      for (var j = 0; j < encryptKeys.length; j++) {\n        var encryptKey = encryptKeys[j];\n        if (encryptKey !== 'key' && encryptKey !== 'value' && encryptKey !== 'few') {\n          throw new Error('Illegal .encrypt subkey: ' + encryptKeys[j]);\n        }\n      }\n    } else {\n      if (/[\\x00-\\x1f\\x7f\\x91\\x92\\.#\\[\\]/]/.test(key) || /[$]/.test(key.slice(1))) {\n        throw new Error('Illegal character in specification key: ' + key);\n      }\n      cleanSpecification(def[key], (path || '') + '/' + key);\n    }\n    switch (key.charAt(0)) {\n      case '$':\n        if (key === '$') break;\n        if (def.$) throw new Error('Multiple wildcard keys in specification at ' + path);\n        def.$ = def[key];\n        delete def[key];\n        break;\n      case '.':\n        if (key !== '.encrypt') throw new Error('Unknown directive at ' + path + ': ' + key);\n        break;\n    }\n  }\n  return def;\n};\n\nexport function throwNotSetUpError() {\n  var e = new Error('Encryption not set up');\n  e.firecrypt = 'NO_KEY';\n  throw e;\n};\n\nexport function computeCacheItemSize(value, key) {\n  return key.length + (typeof value === 'string' ? value.length : 4);\n};\n\nexport function encryptPath(path, def) {\n  def = def || _spec.rules;\n  path = path.slice();\n  for (var i = 0; i < path.length; i++) {\n    def = def[path[i]] || def.$;\n    if (!def) break;\n    if (def['.encrypt'] && def['.encrypt'].key) {\n      path[i] = encrypt(path[i], 'string', def['.encrypt'].key);\n    }\n  }\n  return path;\n};\n\nexport function encryptRef(ref, path) {\n  var encryptedPath = encryptPath(path || refToPath(ref));\n  return encryptedPath.length ? ref.root().child(encryptedPath.join('/')) : ref.root();\n};\n\nexport function decryptRef(ref) {\n  var path = refToPath(ref, true);\n  var changed = false;\n  for (var i = 0; i < path.length; i++) {\n    var decryptedPathSegment = decrypt(path[i]);\n    if (decryptedPathSegment !== path[i]) {\n      path[i] = decryptedPathSegment;\n      changed = true;\n    }\n  }\n  return changed ? ref.root().child(path.join('/')) : ref;\n};\n\nexport function specForPath(path, def) {\n  def = def || _spec.rules;\n  for (var i = 0; def && i < path.length; i++) {\n    def = def[path[i]] || def.$;\n  }\n  return def;\n};\n\nexport function transformValue(path, value, transform) {\n  return transformTree(value, specForPath(path), transform);\n};\n\nexport function transformTree(value, def, transform) {\n  if (!def) return value;\n  var type = getType(value);\n  var i;\n  if (/^(string|number|boolean)$/.test(type)) {\n    if (def['.encrypt'] && def['.encrypt'].value) {\n      value = transform(value, type, def['.encrypt'].value);\n    }\n  } else if (type === 'object' && value !== null) {\n    var transformedValue = {};\n    for (var key in value) {\n      if (!value.hasOwnProperty(key)) continue;\n      var subValue = value[key], subDef;\n      if (key.indexOf('/') >= 0) {  // for deep update keys\n        var keyParts = key.split('/');\n        subDef = def;\n        for (i = 0; i < keyParts.length; i++) {\n          if (transform === decrypt) {\n            keyParts[i] = decrypt(keyParts[i]);\n            subDef = subDef && (subDef[keyParts[i]] || subDef.$);\n          } else {\n            subDef = subDef && (subDef[keyParts[i]] || subDef.$);\n            if (subDef && subDef['.encrypt'] && subDef['.encrypt'].key) {\n              keyParts[i] = transform(keyParts[i], 'string', subDef['.encrypt'].key);\n            }\n          }\n        }\n        key = keyParts.join('/');\n      } else {\n        if (transform === decrypt) {\n          key = decrypt(key);\n          subDef = def[key] || def.$;\n        } else {\n          subDef = def[key] || def.$;\n          if (subDef && subDef['.encrypt'] && subDef['.encrypt'].key) {\n            key = transform(key, 'string', subDef['.encrypt'].key);\n          }\n        }\n      }\n      transformedValue[key] = transformTree(subValue, subDef, transform);\n    }\n    value = transformedValue;\n  } else if (type === 'array') {\n    if (!def.$) return value;\n    for (i = 0; i < value.length; i++) value[i] = transformTree(value[i], def.$, transform);\n  }\n  return value;\n};\n\nexport function refToPath(ref, encrypted) {\n  var root = ref.root();\n  if (ref === root) return [];\n  var pathStr = decodeURIComponent(ref.toString().slice(root.toString().length));\n  if (!encrypted && pathStr && pathStr.charAt(0) !== '.' &&\n      /[\\x00-\\x1f\\x7f\\x91\\x92\\.#$\\[\\]]/.test(pathStr)) {\n    throw new Error('Path contains invalid characters: ' + pathStr);\n  }\n  return pathStr.split('/');\n};\n\nexport function encrypt(value, type, pattern) {\n  var cacheKey;\n  if (_encryptionCache) {\n    cacheKey = type.charAt(0) + pattern + '\\x91' + value;\n    if (_encryptionCache.has(cacheKey)) return _encryptionCache.get(cacheKey);\n  }\n  var result;\n  if (pattern === '#') {\n    result = encryptValue(value, type);\n  } else {\n    if (type !== 'string') {\n      throw new Error('Can\\'t encrypt a ' + type + ' using pattern [' + pattern + ']');\n    }\n    var match = value.match(compilePattern(pattern));\n    if (!match) {\n      throw new Error(\n        'Can\\'t encrypt as value doesn\\'t match pattern [' + pattern + ']: ' + value);\n    }\n    var i = 0;\n    result = pattern.replace(/[#\\.]/g, function(placeholder) {\n      var part = match[++i];\n      if (placeholder === '#') part = encryptValue(part, 'string');\n      return part;\n    });\n  }\n  if (_encryptionCache) _encryptionCache.set(cacheKey, result);\n  return result;\n};\n\nexport function encryptValue(value, type) {\n  if (!/^(string|number|boolean)$/.test(type)) throw new Error('Can\\'t encrypt a ' + type);\n  switch (type) {\n    case 'number': value = '' + value; break;\n    case 'boolean': value = value ? 't' : 'f'; break;\n  }\n  return '\\x91' + type.charAt(0).toUpperCase() + encryptString(value) + '\\x92';\n};\n\nexport function decrypt(value) {\n  if (_decryptionCache && _decryptionCache.has(value)) return _decryptionCache.get(value);\n  if (!/\\x91/.test(value)) return value;\n  var result;\n  var match = value.match(/^\\x91(.)([^\\x92]*)\\x92$/);\n  if (match) {\n    var decryptedString = decryptString(match[2]);\n    switch (match[1]) {\n      case 'S':\n        result = decryptedString;\n        break;\n      case 'N':\n        result = Number(decryptedString);\n        // Check for NaN, since it's the only value where x !== x.\n        if (result !== result) throw new Error('Invalid encrypted number: ' + decryptedString);\n        break;\n      case 'B':\n        if (decryptedString === 't') result = true;\n        else if (decryptedString === 'f') result = false;\n        else throw new Error('Invalid encrypted boolean: ' + decryptedString);\n        break;\n      default:\n        throw new Error('Invalid encrypted value type code: ' + match[1]);\n    }\n  } else {\n    result = value.replace(/\\x91(.)([^\\x92]*)\\x92/g, function(match, typeCode, encryptedString) {\n      if (typeCode !== 'S') throw new Error('Invalid multi-segment encrypted value: ' + typeCode);\n      return decryptString(encryptedString);\n    });\n  }\n  if (_decryptionCache) _decryptionCache.set(value, result);\n  return result;\n};\n\nexport function getType(value) {\n  if (Array.isArray(value)) return 'array';\n  var type = typeof value;\n  if (type === 'object') {\n    if (value instanceof String) type = 'string';\n    else if (value instanceof Number) type = 'number';\n    else if (value instanceof Boolean) type = 'boolean';\n  }\n  return type;\n};\n\nvar patternRegexes = {};\nexport function compilePattern(pattern) {\n  var regex = patternRegexes[pattern];\n  if (!regex) {\n    regex = patternRegexes[pattern] = new RegExp('^' + pattern\n      .replace(/\\./g, '#')\n      .replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&')  // escape regex chars\n      .replace(/#/g, '(.*?)') + '$');\n  }\n  return regex;\n};\n","if (typeof require !== 'undefined') {\n  if (typeof Firebase === 'undefined') global.Firebase = require('firebase');\n  if (typeof LRUCache === 'undefined') global.LRUCache = require('lru-cache');\n  if (typeof CryptoJS === 'undefined') global.CryptoJS = require('crypto-js/core');\n  require('crypto-js/enc-base64');\n  require('cryptojs-extension/build_node/siv');\n  try {\n    require('firebase-childrenkeys');\n  } catch (e) {\n    // ignore, not installed\n  }\n}\n\nCryptoJS.enc.Base64UrlSafe = {\n  stringify: CryptoJS.enc.Base64.stringify,\n  parse: CryptoJS.enc.Base64.parse,\n  _map: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_'\n};\n\n\nvar fbp = Firebase.prototype;\nvar originalQueryFbp = {};\nvar firebaseWrapped = false;\nvar encryptString, decryptString;\n\nimport * as utils from './utils';\n\nFirebase.initializeEncryption = function(options, specification) {\n  var result;\n  options.cacheSize = options.cacheSize || 5 * 1000 * 1000;\n  options.encryptionCacheSize = options.encryptionCacheSize || options.cacheSize;\n  options.decryptionCacheSize = options.decryptionCacheSize || options.cacheSize;\n  encryptString = decryptString = utils.throwNotSetUpError;\n  if (typeof LRUCache === 'function') {\n    utils.setEncryptionCache(new LRUCache({\n      max: options.encryptionCacheSize, length: utils.computeCacheItemSize\n    }));\n    utils.setDecryptionCache(new LRUCache({\n      max: options.decryptionCacheSize, length: utils.computeCacheItemSize\n    }));\n  }\n  switch (options.algorithm) {\n    case 'aes-siv':\n      if (!options.key) throw new Error('You must specify a key to use AES encryption.');\n      result = setupAesSiv(options.key, options.keyCheckValue);\n      break;\n    case 'passthrough':\n      encryptString = decryptString = function(str) {return str;};\n      break;\n    case 'none':\n      break;\n    default:\n      throw new Error('Unknown encryption algorithm \"' + options.algorithm + '\".');\n  }\n  utils.setSpec(specification);\n  wrapFirebase();\n  return result;\n};\n\nfunction setupAesSiv(key, checkValue) {\n  var siv = CryptoJS.SIV.create(CryptoJS.enc.Base64.parse(key));\n  encryptString = function(str) {\n    return CryptoJS.enc.Base64UrlSafe.stringify(siv.encrypt(str));\n  };\n  decryptString = function(str) {\n    var result = siv.decrypt(CryptoJS.enc.Base64UrlSafe.parse(str));\n    if (result === false) {\n      var e = new Error('Wrong decryption key');\n      e.firecrypt = 'WRONG_KEY';\n      throw e;\n    }\n    return CryptoJS.enc.Utf8.stringify(result);\n  };\n  if (checkValue) decryptString(checkValue);\n  return encryptString(CryptoJS.enc.Base64UrlSafe.stringify(CryptoJS.lib.WordArray.random(10)));\n}\n\nfunction Query(query, order, original) {\n  this._query = query;\n  this._order = order || {};\n  this._original = original || query;\n}\nQuery.prototype.on = function(eventType, callback, cancelCallback, context) {\n  wrapQueryCallback(callback);\n  return this._original.on.call(\n    this._query, eventType, callback.firecryptCallback, cancelCallback, context);\n};\nQuery.prototype.off = function(eventType, callback, context) {\n  if (callback && callback.firecryptCallback) callback = callback.firecryptCallback;\n  return this._original.off.call(this._query, eventType, callback, context);\n};\nQuery.prototype.once = function(eventType, successCallback, failureCallback, context) {\n  wrapQueryCallback(successCallback);\n  return this._original.once.call(\n    this._query, eventType, successCallback && successCallback.firecryptCallback, failureCallback,\n    context\n  ).then(function(snap) {\n    return new Snapshot(snap);\n  });\n};\nQuery.prototype.orderByChild = function(key) {\n  return this._orderBy('orderByChild', 'child', key);\n};\nQuery.prototype.orderByKey = function() {\n  return this._orderBy('orderByKey', 'key');\n};\nQuery.prototype.orderByValue = function() {\n  return this._orderBy('orderByValue', 'value');\n};\nQuery.prototype.orderByPriority = function() {\n  return this._orderBy('orderByPriority', 'priority');\n};\nQuery.prototype.startAt = function(value, key) {\n  this._checkCanSort(key !== undefined);\n  return this._delegate('startAt', arguments);\n};\nQuery.prototype.endAt = function(value, key) {\n  this._checkCanSort(key !== undefined);\n  return this._delegate('endAt', arguments);\n};\nQuery.prototype.equalTo = function(value, key) {\n  if (this._order[this._order.by + 'Encrypted']) {\n    value = utils.encrypt(value, utils.getType(value), this._order[this._order.by + 'Encrypted']);\n  }\n  if (key !== undefined && this._order.keyEncrypted) {\n    key = utils.encrypt(key, 'string', this._order.keyEncrypted);\n  }\n  return new Query(this._original.equalTo.call(this._query, value, key), this._order);\n};\nQuery.prototype.limitToFirst = function() {\n  return this._delegate('limitToFirst', arguments);\n};\nQuery.prototype.limitToLast = function() {\n  return this._delegate('limitToLast', arguments);\n};\nQuery.prototype.limit = function() {\n  return this._delegate('limit', arguments);\n};\nQuery.prototype.ref = function() {\n  return utils.decryptRef(this._original.ref.call(this._query));\n};\nQuery.prototype._delegate = function(methodName, args) {\n  return new Query(this._original[methodName].apply(this._query, args), this._order);\n};\nQuery.prototype._checkCanSort = function(hasExtraKey) {\n  if (this._order.by === 'key' ?\n      this._order.keyEncrypted :\n      this._order.valueEncrypted || hasExtraKey && this._order.keyEncrypted) {\n    throw new Error('Encrypted items cannot be ordered');\n  }\n};\nQuery.prototype._orderBy = function(methodName, by, childKey) {\n  var def = utils.specForPath(utils.refToPath(this.ref()));\n  var order = {by: by};\n  var encryptedChildKey;\n  if (def) {\n    var childPath = childKey && childKey.split('/');\n    for (var subKey in def) {\n      if (!def.hasOwnProperty(subKey)) continue;\n      var subDef = def[subKey];\n      if (subDef['.encrypt']) {\n        if (subDef['.encrypt'].key) order.keyEncrypted = subDef['.encrypt'].key;\n        if (subDef['.encrypt'].value) order.valueEncrypted = subDef['.encrypt'].value;\n      }\n      if (childKey) {\n        var childDef = utils.specForPath(childPath, subDef);\n        if (childDef && childDef['.encrypt'] && childDef['.encrypt'].value) {\n          order.childEncrypted = childDef['.encrypt'].value;\n        }\n        var encryptedChildKeyCandidate = utils.encryptPath(childPath, subDef).join('/');\n        if (encryptedChildKey && encryptedChildKeyCandidate !== encryptedChildKey) {\n          throw new Error(\n            'Incompatible encryption specifications for orderByChild(\"' + childKey + '\")');\n        }\n        encryptedChildKey = encryptedChildKeyCandidate;\n      }\n    }\n  }\n  if (childKey) {\n    return new Query(\n      this._original[methodName].call(this._query, encryptedChildKey || childKey), order);\n  } else {\n    return new Query(this._original[methodName].call(this._query), order);\n  }\n};\n\n\nfunction Snapshot(snap) {\n  this._ref = utils.decryptRef(snap.ref());\n  this._path = utils.refToPath(this._ref);\n  this._snap = snap;\n}\ndelegateSnapshot('exists');\ndelegateSnapshot('hasChildren');\ndelegateSnapshot('numChildren');\ndelegateSnapshot('getPriority');\nSnapshot.prototype.val = function() {\n  return utils.transformValue(this._path, this._snap.val(), utils.decrypt);\n};\nSnapshot.prototype.child = function(childPath) {\n  return new Snapshot(this._snap.child(childPath));\n};\nSnapshot.prototype.forEach = function(action) {\n  return this._snap.forEach(function(childSnap) {\n    return action(new Snapshot(childSnap));\n  });\n};\nSnapshot.prototype.hasChild = function(childPath) {\n  childPath = utils.encryptPath(childPath.split('/'), utils.specForPath(this._path)).join('/');\n  return this._snap.hasChild(childPath);\n};\nSnapshot.prototype.key = function() {\n  return this._ref.key();\n};\nSnapshot.prototype.name = function() {\n  return this._ref.name();\n};\nSnapshot.prototype.ref = function() {\n  return this._ref;\n};\nSnapshot.prototype.exportVal = function() {\n  return utils.transformValue(this._path, this._snap.exportVal(), utils.decrypt);\n};\n\nfunction OnDisconnect(path, originalOnDisconnect) {\n  this._path = path;\n  this._originalOnDisconnect = originalOnDisconnect;\n}\ninterceptOnDisconnectWrite('set', 0);\ninterceptOnDisconnectWrite('update', 0);\ninterceptOnDisconnectWrite('remove');\ninterceptOnDisconnectWrite('setWithPriority', 0);\ninterceptOnDisconnectWrite('cancel');\n\n\nfunction wrapFirebase() {\n  if (firebaseWrapped) return;\n  interceptWrite('set', 0);\n  interceptWrite('update', 0);\n  interceptPush();\n  interceptWrite('setWithPriority', 0);\n  interceptWrite('setPriority');\n  if (fbp.childrenKeys) interceptChildrenKeys();\n  interceptTransaction();\n  interceptOnDisconnect();\n  [\n    'on', 'off', 'once', 'orderByChild', 'orderByKey', 'orderByValue', 'orderByPriority',\n    'startAt', 'endAt', 'equalTo', 'limitToFirst', 'limitToLast', 'limit', 'ref'\n  ].forEach(function(methodName) {interceptQuery(methodName);});\n  firebaseWrapped = true;\n}\n\nfunction interceptWrite(methodName, argIndex) {\n  var originalMethod = fbp[methodName];\n  fbp[methodName] = function() {\n    var path = utils.refToPath(this);\n    var self = utils.encryptRef(this, path);\n    var args = Array.prototype.slice.call(arguments);\n    if (argIndex >= 0 && argIndex < args.length) {\n      args[argIndex] = utils.transformValue(path, args[argIndex], utils.encrypt);\n    }\n    return originalMethod.apply(self, args);\n  };\n}\n\nfunction interceptPush() {\n  // Firebase.push delegates to Firebase.set, which will take care of encrypting the ref and the\n  // argument.\n  var originalMethod = fbp.push;\n  fbp.push = function() {\n    var ref = originalMethod.apply(this, arguments);\n    var decryptedRef = utils.decryptRef(ref);\n    decryptedRef.then = ref.then;\n    decryptedRef.catch = ref.catch;\n    if (ref.finally) decryptedRef.finally = ref.finally;\n    return decryptedRef;\n  };\n}\n\nfunction interceptChildrenKeys() {\n  var originalMethod = fbp.childrenKeys;\n  fbp.childrenKeys = function() {\n    return originalMethod.apply(utils.encryptRef(this), arguments).then(function(keys) {\n      if (!keys.some(function(key) {return /\\x91/.test(key);})) return keys;\n      return keys.map(utils.decrypt);\n    });\n  };\n}\n\nfunction interceptTransaction() {\n  var originalMethod = fbp.transaction;\n  fbp.transaction = function() {\n    var path = utils.refToPath(this);\n    var self = utils.encryptRef(this, path);\n    var args = Array.prototype.slice.call(arguments);\n    var originalCompute = args[0];\n    args[0] = originalCompute && function(value) {\n      value = utils.transformValue(path, value, utils.decrypt);\n      value = originalCompute(value);\n      value = utils.transformValue(path, value, utils.encrypt);\n      return value;\n    };\n    if (args.length > 1) {\n      var originalOnComplete = args[1];\n      args[1] = originalOnComplete && function(error, committed, snapshot) {\n        return originalOnComplete(error, committed, snapshot && new Snapshot(snapshot));\n      };\n    }\n    return originalMethod.apply(self, args).then(function(result) {\n      result.snapshot = result.snapshot && new Snapshot(result.snapshot);\n      return result;\n    });\n  };\n}\n\nfunction interceptOnDisconnect() {\n  var originalMethod = fbp.onDisconnect;\n  fbp.onDisconnect = function() {\n    var path = utils.refToPath(this);\n    return new OnDisconnect(path, originalMethod.call(utils.encryptRef(this, path)));\n  };\n}\n\nfunction interceptOnDisconnectWrite(methodName, argIndex) {\n  OnDisconnect.prototype[methodName] = function() {\n    var args = Array.prototype.slice.call(arguments);\n    if (argIndex >= 0 && argIndex < args.length) {\n      args[argIndex] = utils.transformValue(this._path, args[argIndex], utils.encrypt);\n    }\n    console.log('ARGS:', args);\n    return this._originalOnDisconnect[methodName].apply(this._originalOnDisconnect, args);\n  };\n}\n\nfunction interceptQuery(methodName) {\n  originalQueryFbp[methodName] = fbp[methodName];\n  fbp[methodName] = function() {\n    var query = new Query(utils.encryptRef(this), {}, originalQueryFbp);\n    return query[methodName].apply(query, arguments);\n  };\n}\n\nfunction wrapQueryCallback(callback) {\n  if (!callback || callback.firecryptCallback) return;\n  var wrappedCallback = function(snap, previousChildKey) {\n    return callback.call(this, new Snapshot(snap), previousChildKey);\n  };\n  wrappedCallback.firecryptCallback = wrappedCallback;\n  callback.firecryptCallback = wrappedCallback;\n}\n\nfunction delegateSnapshot(methodName) {\n  Snapshot.prototype[methodName] = function() {\n    return this._snap[methodName].apply(this._snap, arguments);\n  };\n}\n"],"names":["_spec","_encryptionCache","_decryptionCache","setSpec","spec","cleanSpecification","setEncryptionCache","cache","setDecryptionCache","def","path","keys","Object","i","length","key","encryptKeys","j","encryptKey","Error","test","slice","charAt","$","throwNotSetUpError","e","firecrypt","computeCacheItemSize","value","encryptPath","rules","encrypt","encryptRef","ref","encryptedPath","refToPath","root","child","join","decryptRef","changed","decryptedPathSegment","decrypt","specForPath","transformValue","transform","transformTree","type","getType","transformedValue","hasOwnProperty","subValue","subDef","indexOf","keyParts","split","encrypted","pathStr","decodeURIComponent","toString","pattern","cacheKey","has","get","result","encryptValue","match","compilePattern","replace","placeholder","part","set","toUpperCase","encryptString","decryptedString","decryptString","Number","typeCode","encryptedString","Array","isArray","String","Boolean","patternRegexes","regex","RegExp","require","Firebase","global","LRUCache","CryptoJS","enc","Base64UrlSafe","stringify","Base64","parse","_map","fbp","prototype","originalQueryFbp","firebaseWrapped","initializeEncryption","options","specification","cacheSize","encryptionCacheSize","decryptionCacheSize","utils","max","algorithm","setupAesSiv","keyCheckValue","str","wrapFirebase","checkValue","siv","SIV","create","Utf8","lib","WordArray","random","Query","query","order","original","_query","_order","_original","on","eventType","callback","cancelCallback","context","wrapQueryCallback","call","firecryptCallback","off","once","successCallback","failureCallback","then","snap","Snapshot","orderByChild","_orderBy","orderByKey","orderByValue","orderByPriority","startAt","_checkCanSort","undefined","_delegate","arguments","endAt","equalTo","by","keyEncrypted","limitToFirst","limitToLast","limit","methodName","args","apply","hasExtraKey","valueEncrypted","childKey","encryptedChildKey","childPath","subKey","childDef","childEncrypted","encryptedChildKeyCandidate","_ref","_path","_snap","delegateSnapshot","val","forEach","action","childSnap","hasChild","name","exportVal","OnDisconnect","originalOnDisconnect","_originalOnDisconnect","interceptOnDisconnectWrite","interceptWrite","interceptPush","childrenKeys","interceptChildrenKeys","interceptTransaction","interceptOnDisconnect","interceptQuery","argIndex","originalMethod","self","push","decryptedRef","catch","finally","some","map","transaction","originalCompute","originalOnComplete","error","committed","snapshot","onDisconnect","console","log","wrappedCallback","previousChildKey"],"mappings":"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"}